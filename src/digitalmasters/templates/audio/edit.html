{% extends "site_base.html" %}

{% block page-subtitle %}: Audio : Edit {{ obj.label }}{% endblock %}
{% block content-title %}Edit Audio File{% endblock %}

{% block content-body %}
{{ block.super }}
<h2>{{ obj.label }}</h2>
<p class='extra'>
  {% if obj and obj.ark %}
    This file is <a href='{{obj.ark_access_uri}}'>{{obj.ark}}</a>.
  {% else %}
    This file has no ARK. Its pid is {{obj.pid}}.
  {% endif %}
  <a href="{% url audio:download-audio obj.pid %}">original audio</a>
  {% if obj.compressed_audio.exists %}
     | <a href="{% url audio:download-compressed-audio obj.pid %}">access copy</a>
  {% endif %}
</p>
{% with obj.conversion_result as conversion %}
  {% if conversion %}
  <p class="extra">
    Access copy conversion requested at {{ conversion.created }};
    {% if conversion.task_end %}
       completed {{ obj.conversion_result.task_end|timesince }} ago,
       took {{ obj.conversion_result.duration }}.
    {% endif %}
    {{ conversion.task.status }} {{ conversion.task.result|default:'' }}
  </p>
  {% endif %}
{% endwith %}

<p class="extra">
  View raw datastreams:
   <a href="{% url audio:raw-ds obj.pid 'mods' %}">MODS</a> |
   <a href="{% url audio:raw-ds obj.pid 'dc' %}">DC</a> |
   <a href="{% url audio:raw-ds obj.pid 'rels-ext' %}">RELS-EXT</a> |
   <a href="{% url audio:raw-ds obj.pid 'sourcetech' %}">SourceTech</a> |
   <a href="{% url audio:raw-ds obj.pid 'digitaltech' %}">DigitalTech</a>
</p>
<script type="text/javascript">
    /* simple javascript section to toggle display of sections and label css classes */
    function toggle_section(section_id, toggle_id) {
        var section = jQuery(section_id);
        section.toggle();
        var label = jQuery(toggle_id);
        label.toggleClass('collapsed', section.is(':hidden'));
    }
</script>

<div id="audio-edit">
<form method="post" name="edit_form">{% csrf_token %}

<a onClick="javascript:toggle_section('#mods', '#mods-label');"> {#jQuery('#mods').toggle()"> #}
  <h3 id="mods-label" class="section-head toggle open">Descriptive Metadata</h3>
</a>
<div id="mods">    
    {% if form.mods.non_field_errors %}
    {{ form.mods.non_field_errors }}
    {% endif %}
<table class="audio-edit">
  {% if form.mods.non_field_errors %}
    <tr><td colspan="2">{{ form.non_field_errors }}</td></tr>
  {% endif %}
  {% for field in form %}{% include 'audio/_edit_form_field.html' %}{% endfor %}
  {% if form.mods.non_field_errors %}
    <tr><td colspan="2">{{ form.mods.non_field_errors }}</td></tr>
  {% endif %}
  {% for field in form.mods %}{% include 'audio/_edit_form_field.html' %}{% endfor %}
  {% comment %} TODO/FIXME: something like this should work, but need a way to get subform labels
   {% for name, subform in form.mods.subforms.items %}
    <tr>
       <th>{{ subform.label }}{{ name }}</th>
       <td>{{ subform.as_p }}</td>
    </tr>
  {% endfor %}
  {% endcomment %}
  <tr id="origin_info">
      <th>Origin Info:</th>
      <td>{{ form.mods.subforms.origin_info.as_p }}</td>
    </tr>
    <tr>
      <th>General Note:</th>
      <td>{{ form.mods.subforms.general_note.as_p }}</td>
    </tr>
    <tr>
      <th>Part Note:</th>
      <td>{{ form.mods.subforms.part_note.as_p }}</td>
    </tr>
</table>
</div>

<a onClick="javascript:toggle_section('#source-tech', '#source-tech-label')">
  <h3 id="source-tech-label" class="section-head toggle">Source Technical Metadata</h3>
</a>
<div id="source-tech">
    {{ form.sourcetech.non_field_errors }}
    <table class="audio-edit">
        {% for field in form.sourcetech %}{% include 'audio/_edit_form_field.html' %}{% endfor %}
    </table>
</div>

<a onClick="javascript:toggle_section('#digital-tech', '#digital-tech-label')">
  <h3 id="digital-tech-label" class="section-head toggle">Digital Technical Metadata</h3>
</a>
<div id="digital-tech">
    {{ form.digitaltech.non_field_errors }}
    <table class="audio-edit">
        {% for field in form.digitaltech %}{% include 'audio/_edit_form_field.html' %}{% endfor %}
    </table>
</div>

<input class="form-submit" type="submit" name="_save" value="Save"/>
<input class="form-submit" type="submit" name="_save_continue" value="Save and continue editing"/>
</form>
</div>

<script type="text/javascript">
  window.onload = document.edit_form.elements[1].focus();
</script>
{% endblock %}
